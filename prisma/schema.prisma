generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id           String         @id @default(cuid())
  name         String
  email        String         @unique
  password     String
  role         UserRole       @default(BARBER)
  bio          String?        @db.Text
  imageUrl     String?
  isActive     Boolean        @default(true)
  
  // Relations (only for barbers)
  appointments Appointment[]
  availability Availability[]
  blockouts    TimeBlockout[]
  
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  
  @@index([email])
  @@index([role])
}

enum UserRole {
  ADMIN
  BARBER
}

model Appointment {
  id                String            @id @default(cuid())
  referenceNumber   String            @unique
  startTime         DateTime
  endTime           DateTime
  status            AppointmentStatus @default(PENDING)
  notes             String?           @db.Text
  
  customerName      String
  customerEmail     String
  customerPhone     String?
  
  barber            User              @relation(fields: [barberId], references: [id], onDelete: Cascade)
  barberId          String
  
  // Service details stored directly (no foreign key)
  serviceName       String
  servicePrice      Decimal           @db.Decimal(10, 2)
  serviceDuration   Int               // Duration in minutes
  
  emailReminderSent Boolean           @default(false)
  
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  
  @@index([barberId])
  @@index([startTime])
  @@index([status])
  @@index([referenceNumber])
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  NO_SHOW
}

model Availability {
  id         String   @id @default(cuid())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String
  dayOfWeek  Int      // 0-6, where 0 is Sunday
  startTime  String   // Format: "HH:MM" 
  endTime    String   // Format: "HH:MM"
  isWorking  Boolean  @default(true)
  
  @@unique([userId, dayOfWeek])
  @@index([userId])
}

model TimeBlockout {
  id            String          @id @default(cuid())
  user          User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId        String
  startTime     DateTime
  endTime       DateTime
  reason        String?         @db.Text
  recurring     RecurringType?
  occurrences   Int?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  
  @@index([userId])
  @@index([startTime, endTime])
}

enum RecurringType {
  WEEKLY
  BIWEEKLY
  MONTHLY
}

model Settings {
  id                       String   @id @default(cuid())
  shopName                 String   @default("Premium Barber Shop")
  shopAddress              String?
  shopPhone                String?
  shopEmail                String?
  shopHoursStart           String   @default("09:00")
  shopHoursEnd             String   @default("18:00")
  timeSlotInterval         Int      @default(30)
  minAdvanceBookingHours   Int      @default(1)
  maxAdvanceBookingDays    Int      @default(30)
  reminderHours            Int      @default(24)
  emailConfirmationEnabled Boolean  @default(true)
  emailReminderEnabled     Boolean  @default(true)
  updatedAt                DateTime @updatedAt
}